<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Module: db-persist</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Module: db-persist</h1>

    




<section>

<header>
    
        
    
</header>

<article>
    <div class="container-overview">
    
        

        
    
    </div>

    

    

    

    

    

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="~userUpdate"><span class="type-signature">(inner) </span>userUpdate<span class="type-signature"></span></h4>




<div class="description">
    see db-persist#updateUserData
</div>







<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="modules_db-persist.js.html">modules/db-persist.js</a>, <a href="modules_db-persist.js.html#line202">line 202</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="~userUpdate"><span class="type-signature">(inner) </span>userUpdate<span class="type-signature"></span></h4>




<div class="description">
    see db-persist#postUserData
</div>







<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="modules_db-persist.js.html">modules/db-persist.js</a>, <a href="modules_db-persist.js.html#line132">line 132</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id=".createUser"><span class="type-signature">(static) </span>createUser<span class="signature">(userData)</span><span class="type-signature"> &rarr; {Object.adminUpdate|Object.userUpdate}</span></h4>
    

    



<div class="description">
    Create a user. First, a digest authentication request to MongoDB Atlas API is made to create a new user in the admin database.
Second, the user data is posted in the User collection with the password field omitted.
Mongo Atlas API allows the use of the admin database on the cloud instance of MongoDB, which provides password hashing and a lot of security for user data.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>userData</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The user information to be posted to MongoDB
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>roles</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The roles of the new user. Can be 'user' or 'user reviewer'. Based on this field, user permissions are set</td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="modules_db-persist.js.html">modules/db-persist.js</a>, <a href="modules_db-persist.js.html#line53">line 53</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>
<ul>
        <li>
<div class="param-desc">
    - The result from the Mongo Atlas API call
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object.adminUpdate</span>


    </dd>
</dl>
</li>
    
        <li>
<div class="param-desc">
    - The result from inserting the user data in the Mongo db User database
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object.userUpdate</span>


    </dd>
</dl>
</li>
    </ul>





        
            

    

    
    <h4 class="name" id=".getUserByUsername"><span class="type-signature">(static) </span>getUserByUsername<span class="signature">(user)</span><span class="type-signature"> &rarr; {Object}</span></h4>
    

    



<div class="description">
    Fetch a user by his username.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>user</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The user to be fetched</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="modules_db-persist.js.html">modules/db-persist.js</a>, <a href="modules_db-persist.js.html#line262">line 262</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    - The User object that matches the input username
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id=".updateUser"><span class="type-signature">(static) </span>updateUser<span class="signature">(options)</span><span class="type-signature"> &rarr; {Object.adminUpdate|Object.userUpdate}</span></h4>
    

    



<div class="description">
    Using Mongo Atlas API, we update the user's permissions to our collections.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The information needed to perform this db operation.
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>user</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The user credentials</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>data.roles</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The new user roles. Can be 'user' or 'user reviewer'</td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="modules_db-persist.js.html">modules/db-persist.js</a>, <a href="modules_db-persist.js.html#line144">line 144</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>
<ul>
        <li>
<div class="param-desc">
    - The result from the Mongo Atlas API call
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object.adminUpdate</span>


    </dd>
</dl>
</li>
    
        <li>
<div class="param-desc">
    - The result from updating the user data in the Mongo db User database
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object.userUpdate</span>


    </dd>
</dl>
</li>
    </ul>





        
            

    

    
    <h4 class="name" id="~getClientAndCollection"><span class="type-signature">(async, inner) </span>getClientAndCollection<span class="signature">(user, dbName, colName)</span><span class="type-signature"> &rarr; {Object}</span></h4>
    

    



<div class="description">
    Fetches the mongo client and the User collection
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>user</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last">user credentials to authenticate to Mongo</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>dbName</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last">Database name</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>colName</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last">Collection name to fetch</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="modules_db-persist.js.html">modules/db-persist.js</a>, <a href="modules_db-persist.js.html#line37">line 37</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    - client and collection
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="~postUserData"><span class="type-signature">(async, inner) </span>postUserData<span class="signature">(userData, adminUser)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Posts the user data to the User collection. Called by db-persist#createUser
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>userData</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last">The userData to be inserted</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>adminUser</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last">The adminUser credentials</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="modules_db-persist.js.html">modules/db-persist.js</a>, <a href="modules_db-persist.js.html#line213">line 213</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="~updateUserData"><span class="type-signature">(async, inner) </span>updateUserData<span class="signature">(userData, adminUser)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Updates the user data to the User collection. Called by db-persist#updateUser
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>userData</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last">The userData to be inserted</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>adminUser</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last">The adminUser credentials</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="modules_db-persist.js.html">modules/db-persist.js</a>, <a href="modules_db-persist.js.html#line239">line 239</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-activity-persist.html">activity-persist</a></li><li><a href="module-db-persist.html">db-persist</a></li><li><a href="module-results-persist.html">results-persist</a></li><li><a href="module-utils.html">utils</a></li><li><a href="module-v1.html">v1</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Dec 14 2018 11:35:36 GMT+0000 (GMT Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>